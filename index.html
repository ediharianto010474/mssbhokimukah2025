<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Analisis Pertandingan Hoki Bahagian Mukah 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"> 
    <style>
        /* Flash Page Styles */
        #flashPage {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: white;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.5s ease-out;
        }
        #flashPage img {
            width: 100%;
            max-height: 100%;
            object-fit: cover;
        }
        #flashPage p {
            margin-top: 20px;
            font-size: 1.2rem;
            color: #2c3e50;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; }
        }

        /* Main Content Styles */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        * {
            margin: 0; padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            color: var(--dark-color);
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: white;
            color: black;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .logo {
            height: 80px;
            margin-bottom: 15px;
        }
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: black;
        }
        h2 {
            color: var(--secondary-color);
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }
        h3 {
            color: var(--primary-color);
            margin: 20px 0 10px;
        }
        .category-section {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            page-break-inside: avoid;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        .btn {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            margin: 5px;
            text-decoration: none;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn-accent {
            background-color: var(--accent-color);
        }
        .btn-accent:hover {
            background-color: #c0392b;
        }
        .btn-print {
            background-color: #27ae60;
        }
        .btn-print:hover {
            background-color: #219955;
        }
        .btn-schedule {
            background-color: #9b59b6;
        }
        .btn-schedule:hover {
            background-color: #8e44ad;
        }
        .input-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .result-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4f8;
            border-radius: 5px;
            border-left: 4px solid var(--secondary-color);
        }
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .top-buttons {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        .knockout-stage {
            background-color: #f9f9f9;
            border-left: 4px solid #9b59b6;
        }
        .knockout-match {
            font-weight: bold;
        }
        
        /* Popup Styles */
        #popupKeputusan {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        .popup-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 700px;
            width: 90%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .popup-knockout-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        .popup-knockout-type {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 30px;
            color: var(--accent-color);
            text-transform: uppercase;
        }
        .popup-knockout-teams {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
        }
        .popup-knockout-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 40%;
        }
        .popup-knockout-logo {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin-bottom: 15px;
            border: 2px solid #eee;
            border-radius: 50%;
            padding: 5px;
        }
        .popup-knockout-name {
            font-weight: bold;
            font-size: 1.3em;
            text-align: center;
            margin-bottom: 15px;
            min-height: 3em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .popup-knockout-score {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--secondary-color);
            background-color: #f8f9fa;
            padding: 5px 15px;
            border-radius: 5px;
        }
        .popup-knockout-vs {
            font-size: 1.8em;
            font-weight: bold;
            margin: 0 15px;
            color: var(--dark-color);
        }
        .popup-buttons {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #printSections, #printSections * {
                visibility: visible;
            }
            #printSections {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .printable-category {
                page-break-after: always;
                margin: 0;
                padding: 20px;
                box-shadow: none;
                border-radius: 0;
            }
            .printable-category:last-child {
                page-break-after: auto;
            }
            header,
            .no-print,
            .category-section:not(.printable-category) {
                display: none !important;
            }
            @page {
                size: A4 portrait;
                margin: 1cm;
            }
            
            /* Special print styles for popup */
            body.printing-popup * {
                visibility: hidden;
            }
            body.printing-popup #popupPrintArea,
            body.printing-popup #popupPrintArea * {
                visibility: visible;
            }
            body.printing-popup #popupPrintArea {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: white;
                display: flex !important;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
            @page popup-page {
                size: A4 landscape;
                margin: 0;
            }
            body.printing-popup {
                height: 100vh;
                width: 100vw;
            }
            #popupPrintArea {
                transform: rotate(0deg);
                width: 297mm;
                height: 210mm;
                page: popup-page;
            }
            .popup-print-content {
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                padding: 20mm;
                text-align: center;
            }
            .popup-print-title {
                font-size: 3em;
                margin-bottom: 20px;
                color: #2c3e50;
            }
            .popup-print-type {
                font-size: 3.5em;
                font-weight: bold;
                margin-bottom: 40px;
                color: #e74c3c;
                text-transform: uppercase;
            }
            .popup-print-teams {
                display: flex;
                justify-content: space-around;
                align-items: center;
                width: 100%;
                margin: 40px 0;
            }
            .popup-print-team {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 40%;
            }
            .popup-print-logo {
                width: 150px;
                height: 150px;
                object-fit: contain;
                margin-bottom: 20px;
                border: 3px solid #eee;
                border-radius: 50%;
                padding: 10px;
            }
            .popup-print-name {
                font-size: 2em;
                margin: 20px 0;
                text-align: center;
                font-weight: bold;
            }
            .popup-print-score {
                font-size: 4em;
                font-weight: bold;
                color: #3498db;
                background-color: #f8f9fa;
                padding: 10px 30px;
                border-radius: 10px;
            }
            .popup-print-vs {
                font-size: 3em;
                font-weight: bold;
                margin: 0 30px;
            }
            .popup-print-footer {
                margin-top: 50px;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>

<!-- Flash Page -->
<div id="flashPage">
    <img src="https://i.postimg.cc/YS2yT88h/hokimssb2025.jpg" alt="Banner Kejohanan Hoki MSSD Bahagian Mukah 2025">
    <p>Memuatkan sistem...</p>
</div>

<!-- Main Content -->
<div class="container no-print" style="display: none;">
    <header>
        <img src="https://i.postimg.cc/MTFGgRwx/Chat-GPT-Image-Jun-14-2025-12-09-31-AM.png" alt="Logo Pertandingan Hoki" class="logo">
        <h1>Sistem Analisis Pertandingan Hoki</h1>
        <p>Bahagian Mukah 2025 | 2-3 Julai 2025 | 8:00 pagi - 5:00 petang</p>
    </header>
    <div class="top-buttons">
        <a href="jadual.html" class="btn btn-schedule"><i class="fas fa-calendar-alt"></i> Jadual Perlawanan</a>
    </div>
    <section class="category-section no-print">
        <h2>Kemaskini Keputusan</h2>
        <div class="input-group">
            <label for="category">Pilih Kategori:</label>
            <select id="category"></select>
        </div>
        <div class="input-group">
            <label for="match">Pilih Perlawanan:</label>
            <select id="match"></select>
        </div>
        <div class="input-group">
            <label for="score1">Skor Pasukan 1:</label>
            <input type="number" id="score1" min="0" value="0">
        </div>
        <div class="input-group">
            <label for="score2">Skor Pasukan 2:</label>
            <input type="number" id="score2" min="0" value="0">
        </div>
        <div class="action-buttons">
            <button class="btn" id="updateResult">Kemaskini Keputusan</button>
            <div>
                <button class="btn btn-accent" id="resetAll">Reset Semua Keputusan</button>
                <button class="btn btn-print" id="printResults"><i class="fas fa-print"></i> Cetak</button>
            </div>
        </div>
        <div class="result-section" id="resultMessage">
            Pilih perlawanan dan masukkan keputusan untuk dikemaskini.
        </div>
    </section>
    <div id="categoriesContainer"></div>
</div>

<!-- Print Sections -->
<div id="printSections"></div>

<!-- Popup Keputusan -->
<div id="popupKeputusan">
    <div class="popup-content">
        <div class="popup-knockout-title" id="popupKategori"></div>
        <div class="popup-knockout-type" id="popupMatchType"></div>
        
        <div class="popup-knockout-teams">
            <div class="popup-knockout-team">
                <img id="logo1" src="" alt="Logo 1" class="popup-knockout-logo">
                <div class="popup-knockout-name" id="nama1">Pasukan 1</div>
                <div class="popup-knockout-score" id="jaringan1">0</div>
            </div>
            
            <div class="popup-knockout-vs">VS</div>
            
            <div class="popup-knockout-team">
                <img id="logo2" src="" alt="Logo 2" class="popup-knockout-logo">
                <div class="popup-knockout-name" id="nama2">Pasukan 2</div>
                <div class="popup-knockout-score" id="jaringan2">0</div>
            </div>
        </div>
        
        <div class="popup-buttons">
            <button onclick="printPopup()" class="btn btn-print"><i class="fas fa-print"></i> Cetak</button>
            <button onclick="tutupPopup()" class="btn btn-accent"><i class="fas fa-times"></i> Tutup</button>
        </div>
    </div>
</div>

<!-- Popup Print Area (hidden until printing) -->
<div id="popupPrintArea" style="display: none;">
    <div class="popup-print-content">
        <h1 class="popup-print-title" id="popupPrintKategori"></h1>
        <h2 class="popup-print-type" id="popupPrintMatchType"></h2>
        
        <div class="popup-print-teams">
            <div class="popup-print-team">
                <img id="logoPrint1" src="" alt="Logo 1" class="popup-print-logo">
                <div class="popup-print-name" id="namaPrint1">Pasukan 1</div>
                <div class="popup-print-score"><span id="jaringanPrint1">0</span></div>
            </div>
            
            <div class="popup-print-vs">VS</div>
            
            <div class="popup-print-team">
                <img id="logoPrint2" src="" alt="Logo 2" class="popup-print-logo">
                <div class="popup-print-name" id="namaPrint2">Pasukan 2</div>
                <div class="popup-print-score"><span id="jaringanPrint2">0</span></div>
            </div>
        </div>
        
        <div class="popup-print-footer">
            Kejohanan Hoki MSSD Bahagian Mukah 2025<br>
            2-3 Julai 2025
        </div>
    </div>
</div>

<!-- Load external schedule.js before main script -->
<script src="schedule.js"></script>

<!-- Internal JS -->
<script>
    // Slot masa
    const timeSlots = [
        '08:00 AM', '08:25 AM', '08:50 AM', '09:15 AM', '09:40 AM',
        '10:05 AM', '10:30 AM', '10:55 AM', '11:20 AM', '11:45 AM',
        '02:00 PM', '02:25 PM', '02:50 PM', '03:15 PM', '03:40 PM',
        '04:05 PM', '04:30 PM', '04:55 PM'
    ];

    // Tarikh perlawanan
    const dates = ["2 Julai 2025", "3 Julai 2025"];

    // Tournament data structure
    const tournamentData = {};

    // Logo Pasukan
    const logoPasukan = {
        "SMK BELAWAI": "https://i.postimg.cc/CKMxRtkb/BELAWAI.jpg",
        "SMK 3 RIVERS": "https://i.postimg.cc/rFgb8PVB/3RIVERS.png",
        "SMK AGAMA IGAN": "https://i.postimg.cc/2SrZx0nS/AGAMA-IGAN.jpg",
        "SMK BATANG IGAN": "https://i.postimg.cc/htNqB5MS/BATANG-IGAN.png",
        "SMK DALAT": "https://i.postimg.cc/wj8VY5JC/DALAT.jpg",
        "PASUKAN DARO": "https://i.postimg.cc/T12PD4Zz/DARO.png",
        "SMK MUKAH": "https://i.postimg.cc/sXQk095M/MUKAH.png",
        "SMK NORMAH": "https://i.postimg.cc/rwR5sDGS/NORMAH.png",
        "PASUKAN DALAT": "https://i.postimg.cc/90TrV9HM/PPDDALAT.jpg",
        "PASUKAN MUKAH": "https://i.postimg.cc/QNB61dqd/PPDMUKAH.jpg"
    };

    // Generate matches logic
    function generateGroupMatches(groupId) {
        const group = groups[groupId];
        const matches = [];
        const teams = group.teams;

        for (let i = 0; i < teams.length; i++) {
            for (let j = i + 1; j < teams.length; j++) {
                matches.push({
                    team1: `${groupId}${i+1}) ${teams[i]}`,
                    team2: `${groupId}${j+1}) ${teams[j]}`,
                    score1: null,
                    score2: null,
                    completed: false,
                    groupId: groupId,
                    type: 'group'
                });
            }
        }

        let currentDay = 0;
        let timeSlotIndex = 0;
        for (const match of matches) {
            if (timeSlotIndex >= timeSlots.length) {
                currentDay++;
                timeSlotIndex = 0;
                if (currentDay >= dates.length) break;
            }
            match.date = dates[currentDay];
            match.time = timeSlots[timeSlotIndex];
            timeSlotIndex++;
        }

        return matches;
    }

    // Generate knockout matches for groups C and D
    function generateKnockoutMatches() {
        const knockoutMatches = [];
        const semifinalTime = '02:00 PM';
        const finalTime = '03:15 PM';
        const thirdPlaceTime = '03:15 PM';
        
        // Semifinal 1: Johan C vs Naib Johan D
        knockoutMatches.push({
            team1: 'Johan Kumpulan C',
            team2: 'Naib Johan Kumpulan D',
            score1: null,
            score2: null,
            completed: false,
            date: '3 Julai 2025',
            time: semifinalTime,
            type: 'semifinal',
            matchId: 'sf1'
        });
        
        // Semifinal 2: Johan D vs Naib Johan C
        knockoutMatches.push({
            team1: 'Johan Kumpulan D',
            team2: 'Naib Johan Kumpulan C',
            score1: null,
            score2: null,
            completed: false,
            date: '3 Julai 2025',
            time: '02:25 PM',
            type: 'semifinal',
            matchId: 'sf2'
        });
        
        // Final: Pemenang SF1 vs Pemenang SF2
        knockoutMatches.push({
            team1: 'Pemenang SF1',
            team2: 'Pemenang SF2',
            score1: null,
            score2: null,
            completed: false,
            date: '3 Julai 2025',
            time: finalTime,
            type: 'final',
            matchId: 'final'
        });
        
        // Tempat ketiga: Kalah SF1 vs Kalah SF2
        knockoutMatches.push({
            team1: 'Kalah SF1',
            team2: 'Kalah SF2',
            score1: null,
            score2: null,
            completed: false,
            date: '3 Julai 2025',
            time: thirdPlaceTime,
            type: 'thirdplace',
            matchId: 'thirdplace'
        });
        
        return knockoutMatches;
    }

    // Initialize tournament data
    for (const id in groups) {
        tournamentData[id] = {
            name: groups[id].name,
            teams: groups[id].teams,
            matches: generateGroupMatches(id),
            standings: initializeStandings(groups[id].teams)
        };
    }

    // Add knockout stage for groups C and D
    if (groups['C'] && groups['D']) {
        tournamentData['knockout'] = {
            name: 'Peringkat Kalah Mati (Kumpulan C & D)',
            matches: generateKnockoutMatches()
        };
    }

    function initializeStandings(teams) {
        const standings = {};
        teams.forEach(team => {
            standings[team] = {
                played: 0,
                wins: 0,
                draws: 0,
                losses: 0,
                goalsFor: 0,
                goalsAgainst: 0,
                points: 0
            };
        });
        return standings;
    }

    function recalculateStandings(groupId) {
        const data = tournamentData[groupId];
        data.standings = initializeStandings(data.teams);
        data.matches.forEach(match => {
            if (match.completed) {
                const s = data.standings;
                const team1 = match.team1.split(') ')[1];
                const team2 = match.team2.split(') ')[1];
                const { score1, score2 } = match;

                s[team1].played += 1;
                s[team1].goalsFor += score1;
                s[team1].goalsAgainst += score2;

                s[team2].played += 1;
                s[team2].goalsFor += score2;
                s[team2].goalsAgainst += score1;

                if (score1 > score2) {
                    s[team1].wins += 1; s[team1].points += 3;
                    s[team2].losses += 1;
                } else if (score1 < score2) {
                    s[team2].wins += 1; s[team2].points += 3;
                    s[team1].losses += 1;
                } else {
                    s[team1].draws += 1; s[team2].draws += 1;
                    s[team1].points += 1; s[team2].points += 1;
                }
            }
        });
    }

    function updateKnockoutTeams() {
        if (!tournamentData['knockout']) return;
        
        const knockout = tournamentData['knockout'];
        const groupC = tournamentData['C'];
        const groupD = tournamentData['D'];
        
        if (!groupC || !groupD) return;
        
        // Get top 2 teams from each group
        const cStandings = Object.entries(groupC.standings)
            .map(([team, stats]) => ({ team, ...stats, goalDifference: stats.goalsFor - stats.goalsAgainst }))
            .sort((a, b) => b.points - a.points || b.goalDifference - a.goalDifference || b.goalsFor - a.goalsFor);
            
        const dStandings = Object.entries(groupD.standings)
            .map(([team, stats]) => ({ team, ...stats, goalDifference: stats.goalsFor - stats.goalsAgainst }))
            .sort((a, b) => b.points - a.points || b.goalDifference - a.goalDifference || b.goalsFor - a.goalsFor);
        
        // Update semifinal teams
        knockout.matches.forEach(match => {
            if (match.type === 'semifinal') {
                if (match.matchId === 'sf1') {
                    // Johan C vs Naib Johan D
                    match.team1 = `C1) ${cStandings[0].team}`;
                    match.team2 = `D2) ${dStandings[1].team}`;
                } else if (match.matchId === 'sf2') {
                    // Johan D vs Naib Johan C
                    match.team1 = `D1) ${dStandings[0].team}`;
                    match.team2 = `C2) ${cStandings[1].team}`;
                }
            }
        });
        
        // Update final and third place teams based on semifinal results
        const sf1 = knockout.matches.find(m => m.matchId === 'sf1');
        const sf2 = knockout.matches.find(m => m.matchId === 'sf2');
        
        if (sf1.completed && sf2.completed) {
            const final = knockout.matches.find(m => m.matchId === 'final');
            const thirdPlace = knockout.matches.find(m => m.matchId === 'thirdplace');
            
            // Update final teams
            final.team1 = sf1.score1 > sf1.score2 ? sf1.team1 : sf1.team2;
            final.team2 = sf2.score1 > sf2.score2 ? sf2.team1 : sf2.team2;
            
            // Update third place teams
            thirdPlace.team1 = sf1.score1 < sf1.score2 ? sf1.team1 : sf1.team2;
            thirdPlace.team2 = sf2.score1 < sf2.score2 ? sf2.team1 : sf2.team2;
        }
    }

    function renderCategory(groupId, container) {
        const data = tournamentData[groupId];
        const section = document.createElement('section');
        section.className = 'category-section printable-category';
        if (groupId === 'knockout') {
            section.classList.add('knockout-stage');
        }
        section.id = `${groupId}Section`;
        section.innerHTML = `
            <h2>${data.name}</h2>
            <div class="matches-container">
                <h3>Jadual Perlawanan</h3>
                <table>
                    <thead><tr>
                        <th>Perlawanan</th>
                        <th>Pasukan 1</th>
                        <th>Pasukan 2</th>
                        <th>Keputusan</th>
                        <th>Masa</th>
                        <th>Tarikh</th>
                    </tr></thead>
                    <tbody id="${groupId}Matches"></tbody>
                </table>
            </div>
            ${groupId !== 'knockout' ? `
            <div class="standings">
                <h3>Kedudukan Liga</h3>
                <table>
                    <thead><tr>
                        <th>Nama Pasukan</th>
                        <th>Main</th>
                        <th>Menang</th>
                        <th>Seri</th>
                        <th>Kalah</th>
                        <th>Gol/Bolos</th>
                        <th>Mata</th>
                    </tr></thead>
                    <tbody id="${groupId}Standings"></tbody>
                </table>
            </div>` : ''}
        `;
        container.appendChild(section);
    }

    function renderMatches(groupId) {
        const container = document.getElementById(`${groupId}Matches`);
        if (!container) return;
        
        container.innerHTML = '';
        tournamentData[groupId].matches.forEach((match, index) => {
            const row = document.createElement('tr');
            if (match.type === 'semifinal' || match.type === 'final' || match.type === 'thirdplace') {
                row.classList.add('knockout-match');
            }
            
            let matchName = `Perlawanan ${index + 1}`;
            if (match.type === 'semifinal') matchName = `Separuh Akhir ${match.matchId === 'sf1' ? '1' : '2'}`;
            else if (match.type === 'final') matchName = 'Akhir';
            else if (match.type === 'thirdplace') matchName = 'Tempat Ketiga';
            
            row.innerHTML = `
                <td>${matchName}</td>
                <td>${match.team1}</td>
                <td>${match.team2}</td>
                <td>${match.completed ? `${match.score1}-${match.score2}` : 'Belum dimainkan'}</td>
                <td>${match.time || ''}</td>
                <td>${match.date || ''}</td>
            `;
            container.appendChild(row);
        });
    }

    function renderStandings(groupId) {
        const container = document.getElementById(`${groupId}Standings`);
        if (!container) return;
        
        container.innerHTML = '';

        const standings = Object.entries(tournamentData[groupId].standings)
            .map(([team, stats]) => ({
                team,
                ...stats,
                goalDifference: stats.goalsFor - stats.goalsAgainst
            }))
            .sort((a, b) =>
                b.points - a.points ||
                b.goalDifference - a.goalDifference ||
                b.goalsFor - a.goalsFor
            );

        standings.forEach(stats => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${stats.team}</td>
                <td>${stats.played}</td>
                <td>${stats.wins}</td>
                <td>${stats.draws}</td>
                <td>${stats.losses}</td>
                <td>${stats.goalsFor}-${stats.goalsAgainst}</td>
                <td>${stats.points}</td>
            `;
            container.appendChild(row);
        });
    }

    function updateMatchDropdown() {
        const groupId = document.getElementById('category').value;
        const matchSelect = document.getElementById('match');
        matchSelect.innerHTML = '';
        
        tournamentData[groupId].matches.forEach((match, index) => {
            const option = document.createElement('option');
            option.value = index;
            
            let matchName = `Perlawanan ${index + 1}`;
            if (match.type === 'semifinal') matchName = `Separuh Akhir ${match.matchId === 'sf1' ? '1' : '2'}`;
            else if (match.type === 'final') matchName = 'Akhir';
            else if (match.type === 'thirdplace') matchName = 'Tempat Ketiga';
            
            option.textContent = `${matchName}: ${match.team1} vs ${match.team2}`;
            matchSelect.appendChild(option);
        });
    }

    function updateMatchResult() {
        const groupId = document.getElementById('category').value;
        const matchIndex = parseInt(document.getElementById('match').value);
        const score1 = parseInt(document.getElementById('score1').value);
        const score2 = parseInt(document.getElementById('score2').value);

        if (isNaN(score1) || isNaN(score2)) {
            document.getElementById('resultMessage').innerHTML = '<strong>Error:</strong> Sila masukkan skor yang sah.';
            return;
        }

        const match = tournamentData[groupId].matches[matchIndex];
        match.score1 = score1;
        match.score2 = score2;
        match.completed = true;

        if (groupId !== 'knockout') {
            recalculateStandings(groupId);
            updateKnockoutTeams(); // Update knockout teams when group matches are updated
        } else {
            updateKnockoutTeams(); // Update final/third place if semifinals are completed
        }

        renderMatches(groupId);
        if (groupId !== 'knockout') {
            renderStandings(groupId);
        }
        
        saveToLocalStorage();
        
        let matchName = `Perlawanan ${matchIndex + 1}`;
        let matchType = '';
        if (match.type === 'semifinal') {
            matchName = `Separuh Akhir ${match.matchId === 'sf1' ? '1' : '2'}`;
            matchType = `SEMI FINAL ${match.matchId === 'sf1' ? '1' : '2'}`;
        } else if (match.type === 'final') {
            matchName = 'Akhir';
            matchType = 'AKHIR';
        } else if (match.type === 'thirdplace') {
            matchName = 'Tempat Ketiga';
            matchType = 'TEMPAT KETIGA';
        }
        
        document.getElementById('resultMessage').innerHTML = `
            <strong>Keputusan berjaya dikemaskini!</strong><br>
            ${matchName}: ${match.team1} ${score1}-${score2} ${match.team2}
        `;

        // Show popup
        const nama1 = match.team1.split(') ')[1] || match.team1;
        const nama2 = match.team2.split(') ')[1] || match.team2;

        document.getElementById('popupKategori').innerText = tournamentData[groupId].name;
        document.getElementById('popupMatchType').innerText = matchType;
        document.getElementById('nama1').innerText = nama1;
        document.getElementById('nama2').innerText = nama2;
        document.getElementById('jaringan1').innerText = score1;
        document.getElementById('jaringan2').innerText = score2;
        document.getElementById('logo1').src = logoPasukan[nama1] || "https://via.placeholder.com/120?text=Logo";
        document.getElementById('logo2').src = logoPasukan[nama2] || "https://via.placeholder.com/120?text=Logo";

        // Update print version
        document.getElementById('popupPrintKategori').innerText = tournamentData[groupId].name;
        document.getElementById('popupPrintMatchType').innerText = matchType;
        document.getElementById('namaPrint1').innerText = nama1;
        document.getElementById('namaPrint2').innerText = nama2;
        document.getElementById('jaringanPrint1').innerText = score1;
        document.getElementById('jaringanPrint2').innerText = score2;
        document.getElementById('logoPrint1').src = logoPasukan[nama1] || "https://via.placeholder.com/150?text=Logo";
        document.getElementById('logoPrint2').src = logoPasukan[nama2] || "https://via.placeholder.com/150?text=Logo";

        document.getElementById('popupKeputusan').style.display = 'flex';
    }

    function printPopup() {
        document.body.classList.add('printing-popup');
        document.getElementById('popupPrintArea').style.display = 'block';
        
        setTimeout(() => {
            window.print();
            
            // Reset after printing
            setTimeout(() => {
                document.body.classList.remove('printing-popup');
                document.getElementById('popupPrintArea').style.display = 'none';
            }, 500);
        }, 100);
    }

    function tutupPopup() {
        document.getElementById('popupKeputusan').style.display = 'none';
    }

    function resetAllResults() {
        if (confirm('Adakah anda pasti ingin reset semua keputusan?')) {
            for (const id in tournamentData) {
                tournamentData[id].matches.forEach(m => {
                    m.score1 = null;
                    m.score2 = null;
                    m.completed = false;
                });
                if (id !== 'knockout') {
                    tournamentData[id].standings = initializeStandings(tournamentData[id].teams);
                }
                renderMatches(id);
                if (id !== 'knockout') {
                    renderStandings(id);
                }
            }
            saveToLocalStorage();
            document.getElementById('resultMessage').textContent = 'Semua keputusan telah direset.';
            document.getElementById('score1').value = 0;
            document.getElementById('score2').value = 0;
        }
    }

    function saveToLocalStorage() {
        localStorage.setItem('tournamentData', JSON.stringify(tournamentData));
    }

    function loadFromLocalStorage() {
        const saved = localStorage.getItem('tournamentData');
        if (saved) {
            const parsed = JSON.parse(saved);
            for (const id in parsed) {
                if (tournamentData[id]) {
                    tournamentData[id].matches = parsed[id].matches;
                    if (id !== 'knockout') {
                        tournamentData[id].standings = parsed[id].standings;
                    }
                }
            }
        }
    }

    function handlePrint() {
        const printContainer = document.getElementById('printSections');
        printContainer.innerHTML = '';

        for (const id in tournamentData) {
            const section = document.getElementById(`${id}Section`);
            if (section) {
                const cloned = section.cloneNode(true);
                cloned.classList.add('printable-category');
                printContainer.appendChild(cloned);
            }
        }

        window.print();

        window.onafterprint = () => {
            printContainer.innerHTML = '';
        };
    }

    function showMainContent() {
        const flashPage = document.getElementById('flashPage');
        const mainContent = document.querySelector('.container');
        flashPage.style.opacity = '0';
        setTimeout(() => {
            flashPage.style.display = 'none';
            mainContent.style.display = 'block';
        }, 500);
    }

    window.addEventListener('load', () => setTimeout(showMainContent, 3000));
    document.getElementById('flashPage').addEventListener('click', showMainContent);

    // Load UI
    function initUI() {
        const categorySelect = document.getElementById('category');
        for (const id in groups) {
            const opt = document.createElement('option');
            opt.value = id;
            opt.textContent = groups[id].name;
            categorySelect.appendChild(opt);
        }
        
        // Add knockout option if exists
        if (tournamentData['knockout']) {
            const opt = document.createElement('option');
            opt.value = 'knockout';
            opt.textContent = tournamentData['knockout'].name;
            categorySelect.appendChild(opt);
        }

        const container = document.getElementById('categoriesContainer');
        for (const id in tournamentData) {
            renderCategory(id, container);
            renderMatches(id);
            if (id !== 'knockout') {
                renderStandings(id);
            }
        }

        updateMatchDropdown();
    }

    document.getElementById('category').addEventListener('change', updateMatchDropdown);
    document.getElementById('updateResult').addEventListener('click', updateMatchResult);
    document.getElementById('resetAll').addEventListener('click', resetAllResults);
    document.getElementById('printResults').addEventListener('click', handlePrint);
    window.addEventListener('DOMContentLoaded', () => {
        loadFromLocalStorage();
        initUI();
    });
</script>
</body>
</html>
